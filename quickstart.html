

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Performing a fit &mdash; frank 1.2.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            frank
              <img src="_static/prom_photo.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.2.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using the code</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html"> Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#perform-a-fit-from-the-terminal">Perform a fit from the terminal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fit-for-the-source-geometry">Fit for the source geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-the-fit-s-sensitivity-to-the-hyperparameters">Test the fit’s sensitivity to the hyperparameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#understand-the-model-s-limitations">Understand the model’s limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examine-the-fit-s-convergence">Examine the fit’s convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modify-the-fit-py-script">Modify the <code class="code docutils literal notranslate"><span class="pre">fit.py</span></code> script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#perform-a-fit-using-frank-as-a-python-module">Perform a fit using <code class="code docutils literal notranslate"><span class="pre">frank</span></code> as a Python module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html"> Tutorials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ui.adsabs.harvard.edu/search/q=citations(doi%3A10.1093%2Fmnras%2Fstaa1365)%20&amp;sort=date%20desc%2C%20bibcode%20desc&amp;p_=0"> Papers citing frank</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Under the hood</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="py_API.html"> API</a></li>
<li class="toctree-l1"><a class="reference internal" href="genindex.html"> Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/discsim/frank/blob/master/HISTORY.rst"> Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/discsim/frank"> Github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/discsim/frank/issues"> Submit an issue</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">frank</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Performing a fit</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="performing-a-fit">
<h1>Performing a fit<a class="headerlink" href="#performing-a-fit" title="Permalink to this heading"></a></h1>
<p>You can interface with Frankenstein (<code class="docutils literal notranslate"><span class="pre">frank</span></code>) to perform a fit in 2 ways:
<strong>(1)</strong> run the code directly from the terminal or <strong>(2)</strong> use the code as a Python module.</p>
<section id="perform-a-fit-from-the-terminal">
<h2>Perform a fit from the terminal<a class="headerlink" href="#perform-a-fit-from-the-terminal" title="Permalink to this heading"></a></h2>
<p>To perform a quick fit from the terminal, only a UVTable with the data to
be fit and a <em>.json</em> parameter file (see below) are needed. A UVTable can be extracted
with CASA as demonstrated in <a class="reference internal" href="tutorials/mstable_to_uvtable.html"><span class="doc">this tutorial</span></a>.
The column format is assumed to be <code class="code docutils literal notranslate"><span class="pre">u</span> <span class="pre">[lambda]</span>&#160;&#160;&#160;&#160; <span class="pre">v</span> <span class="pre">[lambda]</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Re(V)</span> <span class="pre">[Jy]</span>&#160;&#160;&#160;&#160; <span class="pre">Im(V)</span> <span class="pre">[Jy]</span>&#160;&#160;&#160;&#160; <span class="pre">Weight</span> <span class="pre">[Jy^-2]</span></code>
if the UVTable is in ASCII format (<code class="code docutils literal notranslate"><span class="pre">.txt</span></code> or <code class="code docutils literal notranslate"><span class="pre">.dat</span></code>),
or <code class="code docutils literal notranslate"><span class="pre">u</span> <span class="pre">[lambda]</span>&#160;&#160;&#160;&#160; <span class="pre">v</span> <span class="pre">[lambda]</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">V</span> <span class="pre">(Re</span> <span class="pre">+</span> <span class="pre">Im</span> <span class="pre">*</span> <span class="pre">1j)</span> <span class="pre">[Jy]</span>&#160;&#160;&#160;&#160; <span class="pre">Weight</span> <span class="pre">[Jy^-2]</span></code>
if the UVTable is in binary format (<code class="code docutils literal notranslate"><span class="pre">.npz</span></code>).</p>
<p>You can quickly run a fit with the default parameter file, <code class="code docutils literal notranslate"><span class="pre">default_parameters.json</span></code> (see below),
by just passing in the filename of the UVTable to be fit with the <code class="code docutils literal notranslate"><span class="pre">-uv</span></code> option. The UVTable can be a <code class="code docutils literal notranslate"><span class="pre">.npz</span></code>, <code class="code docutils literal notranslate"><span class="pre">.txt</span></code> or <code class="code docutils literal notranslate"><span class="pre">.dat</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>frank.fit<span class="w"> </span>-uv<span class="w"> </span>&lt;uvtable_filename.npz&gt;
</pre></div>
</div>
<p>If you want to change the default parameters, provide a custom parameter file with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>frank.fit<span class="w"> </span><span class="o">[</span>-uv<span class="w"> </span>uvtable_filename.npz<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span>&lt;parameter_filename.json&gt;
</pre></div>
</div>
<p>The default parameter file is <code class="docutils literal notranslate"><span class="pre">default_parameters.json</span></code>. You can get it
<a class="reference external" href="https://github.com/discsim/frank/blob/master/frank/default_parameters.json">here</a>,
and it looks like this,</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">&quot;input_output&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">&quot;uvtable_filename&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">&quot;save_dir&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">&quot;save_solution&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">&quot;save_profile_fit&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">&quot;save_vis_fit&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="nt">&quot;save_uvtables&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nt">&quot;save_figures&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">&quot;iteration_diag&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">    </span><span class="nt">&quot;format&quot;</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="linenos">12</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">  </span><span class="nt">&quot;modify_data&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">    </span><span class="nt">&quot;baseline_range&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="nt">&quot;correct_weights&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">    </span><span class="nt">&quot;use_median_weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">&quot;norm_wle&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="linenos">19</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">  </span><span class="nt">&quot;geometry&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">22</span><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gaussian&quot;</span><span class="p">,</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">&quot;fit_phase_offset&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">24</span><span class="w">    </span><span class="nt">&quot;fit_inc_pa&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">25</span><span class="w">    </span><span class="nt">&quot;initial_guess&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">&quot;inc&quot;</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">27</span><span class="w">    </span><span class="nt">&quot;pa&quot;</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">28</span><span class="w">    </span><span class="nt">&quot;dra&quot;</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">29</span><span class="w">    </span><span class="nt">&quot;ddec&quot;</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">&quot;rescale_flux&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">&quot;scale_height&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="linenos">32</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="w">  </span><span class="nt">&quot;hyperparameters&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">35</span><span class="w">    </span><span class="nt">&quot;n&quot;</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">&quot;rout&quot;</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">&quot;alpha&quot;</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="mf">1.05</span><span class="p">,</span>
<span class="linenos">38</span><span class="w">    </span><span class="nt">&quot;p0&quot;</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="linenos">39</span><span class="w">    </span><span class="nt">&quot;wsmooth&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="mf">1e-4</span><span class="p">,</span>
<span class="linenos">40</span><span class="w">    </span><span class="nt">&quot;iter_tol&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="mf">1e-3</span><span class="p">,</span>
<span class="linenos">41</span><span class="w">    </span><span class="nt">&quot;max_iter&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span>
<span class="linenos">42</span><span class="w">    </span><span class="nt">&quot;converge_failure&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;warn&quot;</span><span class="p">,</span>
<span class="linenos">43</span><span class="w">    </span><span class="nt">&quot;nonnegative&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Normal&quot;</span><span class="p">,</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">&quot;I_scale&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="mf">1e5</span>
<span class="linenos">46</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="w">  </span><span class="nt">&quot;plotting&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">49</span><span class="w">    </span><span class="nt">&quot;quick_plot&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">&quot;full_plot&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">&quot;diag_plot&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos">52</span><span class="w">    </span><span class="nt">&quot;deprojec_plot&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos">53</span><span class="w">    </span><span class="nt">&quot;distance&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="linenos">54</span><span class="w">    </span><span class="nt">&quot;force_style&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">55</span><span class="w">    </span><span class="nt">&quot;bin_widths&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">20e3</span><span class="p">,</span><span class="w"> </span><span class="mf">100e3</span><span class="p">],</span>
<span class="linenos">56</span><span class="w">    </span><span class="nt">&quot;stretch&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;power&quot;</span><span class="p">,</span>
<span class="linenos">57</span><span class="w">    </span><span class="nt">&quot;gamma&quot;</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="linenos">58</span><span class="w">    </span><span class="nt">&quot;asinh_a&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="mf">0.02</span><span class="p">,</span>
<span class="linenos">59</span><span class="w">    </span><span class="nt">&quot;iter_plot_range&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="linenos">60</span><span class="w">    </span><span class="nt">&quot;plot_in_logx&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos">61</span><span class="w">    </span><span class="nt">&quot;norm_residuals&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="linenos">62</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">63</span>
<span class="linenos">64</span><span class="w">  </span><span class="nt">&quot;analysis&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">65</span><span class="w">    </span><span class="nt">&quot;compare_profile&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="linenos">66</span><span class="w">    </span><span class="nt">&quot;clean_beam&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;bmaj&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="linenos">67</span><span class="w">                          </span><span class="nt">&quot;bmin&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="linenos">68</span><span class="w">                          </span><span class="nt">&quot;beam_pa&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="linenos">69</span><span class="w">                         </span><span class="p">},</span>
<span class="linenos">70</span><span class="w">    </span><span class="nt">&quot;bootstrap_ntrials&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="linenos">71</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">72</span><span class="p">}</span>
</pre></div>
</div>
<p>Note that anytime you run a fit without specifying <code class="code docutils literal notranslate"><span class="pre">-p</span></code>, frank’s internal <code class="code docutils literal notranslate"><span class="pre">default_parameters.json</span></code> will be used.</p>
<p>You can get a description for each parameter with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import frank.fit; frank.fit.helper()&#39;</span>
</pre></div>
</div>
<p>which returns the contents of <code class="code docutils literal notranslate"><span class="pre">parameter_descriptions.json</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">&quot;input_output&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">&quot;uvtable_filename&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UVTable with data to be fit. An ASCII file should have columns of: u [\\lambda], v [\\lambda], Re(V) [Jy], Im(V) [Jy], weights [Jy^-2]. An npz file should have columns of: u [\\lambda], v [\\lambda], V [Jy; complex: real + imag * 1j], weights [Jy^-2])&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">&quot;save_dir&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Directory in which output datafiles and figures are saved&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">&quot;save_solution&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to save `sol` object (see frank.radial_fitters.FrankFitter)&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">&quot;save_profile_fit&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to save fitted brightness profile&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">&quot;save_vis_fit&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to save fitted visibility distribution&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="nt">&quot;save_uvtables&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to save fitted and residual UV tables (these are reprojected)&quot;</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nt">&quot;save_figures&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to save generated figures selected in &#39;plotting&#39;&quot;</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">&quot;iteration_diag&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to return and save diagnostics of the fit iteration (needed for diag_plot)&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">    </span><span class="nt">&quot;format&quot;</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Output file format. Default is the same as for &#39;uvtable_filename&#39;, else choose from &#39;npz&#39; or &#39;txt&#39;&quot;</span>
<span class="linenos">12</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">  </span><span class="nt">&quot;modify_data&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">    </span><span class="nt">&quot;baseline_range&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;(Deprojected) baseline range outside of which visibilities are truncated, unit=[\\lambda]&quot;</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="nt">&quot;correct_weights&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to estimate the data&#39;s weights (as they may be unknown for mock data)&quot;</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">    </span><span class="nt">&quot;use_median_weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to estimate all weights as the median binned visibility variance (or instead estimate weights using the baseline-dependent variance)&quot;</span><span class="p">,</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">&quot;norm_wle&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wavelength (unit=[m]) by which to normalize the (u, v) points (i.e., convert from [m] to [rad]). Not needed if the (u, v) points are already in units of [\\lambda]&quot;</span>
<span class="linenos">19</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">  </span><span class="nt">&quot;geometry&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">22</span><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;How the geometry is determined: &#39;known&#39; if user-supplied, &#39;gaussian&#39; to fit it with a gaussian, &#39;nonparametric&#39; to fit it nonparametrically&quot;</span><span class="p">,</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">&quot;fit_phase_offset&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to fit for the phase center&quot;</span><span class="p">,</span>
<span class="linenos">24</span><span class="w">    </span><span class="nt">&quot;fit_inc_pa&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to fit for the inclination and position angle&quot;</span><span class="p">,</span>
<span class="linenos">25</span><span class="w">    </span><span class="nt">&quot;initial_guess&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to use the below values of `inc`, `pa`, `dra`, and `ddec` as an initial guess for the geometry (if `fit_phase_offset` is True or `fit_inc_pa` is True, the respective values below will be used. Guess is only used if `type` is &#39;gaussian&#39; or &#39;nonparametric&#39;)&quot;</span><span class="p">,</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">&quot;inc&quot;</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Inclination, unit=[deg]&quot;</span><span class="p">,</span>
<span class="linenos">27</span><span class="w">    </span><span class="nt">&quot;pa&quot;</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Position angle, defined east of north, unit=[deg]&quot;</span><span class="p">,</span>
<span class="linenos">28</span><span class="w">    </span><span class="nt">&quot;dra&quot;</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Delta (offset from 0) right ascension, defined positive for offsets toward east, unit=[arcsec]&quot;</span><span class="p">,</span>
<span class="linenos">29</span><span class="w">    </span><span class="nt">&quot;ddec&quot;</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Delta declination, unit=[arcsec]&quot;</span><span class="p">,</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">&quot;rescale_flux&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to rescale the total flux to account for the source&#39;s inclination (see frank.geometry.rescale_total_flux)&quot;</span><span class="p">,</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">&quot;scale_height&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Parameter values for calcuating the vertical thickness of the disk in terms of its (assumed Gaussian) scale-height: &#39;h0&#39;, &#39;a&#39;, &#39;r0&#39;, &#39;b&#39; in H(r) = h0 * r**a * np.exp(-(r/r0)**b). &#39;r0&#39; should be in [arcsec]. Example (replace single- with double-quotes): {&#39;h0&#39;: -1.0, &#39;a&#39;: 1.0, &#39;r0&#39;: 1.0, &#39;b&#39;: 1.0}&quot;</span><span class="p">,</span>
<span class="linenos">32</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="w">  </span><span class="nt">&quot;hyperparameters&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">35</span><span class="w">    </span><span class="nt">&quot;n&quot;</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number of collocation points used in the fit (suggested range 100 - 300)&quot;</span><span class="p">,</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">&quot;rout&quot;</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maximum disc radius in the fit (best to overestimate size of source), unit=[arcsec]&quot;</span><span class="p">,</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">&quot;alpha&quot;</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Order parameter for the power spectrum&#39;s inverse Gamma prior (suggested range 1.00 - 1.50). If a list, multiple fits will be performed and overplotted.&quot;</span><span class="p">,</span>
<span class="linenos">38</span><span class="w">    </span><span class="nt">&quot;p0&quot;</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Scale parameter for the power spectrum&#39;s inverse Gamma prior (suggested &gt;0, &lt;&lt;1). If &#39;null&#39;, the code will internally choose a sensible value.&quot;</span><span class="p">,</span>
<span class="linenos">39</span><span class="w">    </span><span class="nt">&quot;wsmooth&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Strength of smoothing applied to the power spectrum (suggested range 10^-4 - 10^-1). If a list, multiple fits will be performed and overplotted.&quot;</span><span class="p">,</span>
<span class="linenos">40</span><span class="w">    </span><span class="nt">&quot;iter_tol&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tolerance for fit iteration stopping criterion (suggested &lt;&lt;1)&quot;</span><span class="p">,</span>
<span class="linenos">41</span><span class="w">    </span><span class="nt">&quot;max_iter&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maximum number of fit iterations&quot;</span><span class="p">,</span>
<span class="linenos">42</span><span class="w">    </span><span class="nt">&quot;converge_failure&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;How to treat the case when the fit does not reach convergence by &#39;max_iter&#39;: one of [&#39;raise&#39;, &#39;warn&#39;, &#39;ignore&#39;] to respectively raise an error, raise a warning, or ignore.&quot;</span><span class="p">,</span><span class="w">    </span>
<span class="linenos">43</span><span class="w">    </span><span class="nt">&quot;nonnegative&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether the best-fit nonnegative brightness profile is included in the frank fit solution object&quot;</span><span class="p">,</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The fit method: &#39;Normal&#39; to fit in linear brighness, &#39;LogNormal&#39; to fit in logarithmic brightness&quot;</span><span class="p">,</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">&quot;I_scale&quot;</span><span class="w">          </span><span class="p">:</span><span class="w">  </span><span class="s2">&quot;Brightness scale, unit=[Jy/sr]. Only used if &#39;method&#39; is &#39;LogNormal&#39; -- the &#39;LogNormal&#39; model produces I(&#39;rout&#39;) = &#39;I_scale&#39;&quot;</span>
<span class="linenos">46</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="w">  </span><span class="nt">&quot;plotting&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">49</span><span class="w">    </span><span class="nt">&quot;quick_plot&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to make a figure showing the simplest plots of the fit&quot;</span><span class="p">,</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">&quot;full_plot&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to make a figure more fully showing the fit and its diagnostics&quot;</span><span class="p">,</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">&quot;diag_plot&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to make a diagnostic figure showing fit convergence metrics&quot;</span><span class="p">,</span>
<span class="linenos">52</span><span class="w">    </span><span class="nt">&quot;deprojec_plot&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to make a figure showing the effect of deprojection on the (u, v) points and visibilities&quot;</span><span class="p">,</span>
<span class="linenos">53</span><span class="w">    </span><span class="nt">&quot;distance&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Distance to source, optionally used for plotting, unit=[pc]&quot;</span><span class="p">,</span>
<span class="linenos">54</span><span class="w">    </span><span class="nt">&quot;force_style&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to use preconfigured matplotlib rcParams in generated figures&quot;</span><span class="p">,</span>
<span class="linenos">55</span><span class="w">    </span><span class="nt">&quot;bin_widths&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bin widths in which to bin the observed visibilities, list of float or int, unit=[\\lambda]&quot;</span><span class="p">,</span>
<span class="linenos">56</span><span class="w">    </span><span class="nt">&quot;stretch&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Type of stretch to apply to swept profile image colormaps, either &#39;power&#39; or &#39;asinh&#39;&quot;</span><span class="p">,</span>
<span class="linenos">57</span><span class="w">    </span><span class="nt">&quot;gamma&quot;</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Index of power law normalization to apply to swept profile image colormaps (1.0 = linear scaling)&quot;</span><span class="p">,</span>
<span class="linenos">58</span><span class="w">    </span><span class="nt">&quot;asinh_a&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Scale parameter for an arcsinh normalization to apply to swept profile image colormaps&quot;</span><span class="p">,</span>
<span class="linenos">59</span><span class="w">    </span><span class="nt">&quot;iter_plot_range&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Range of iterations to be plotted in the diagnostic figure, list of int of the form [start, stop]&quot;</span><span class="p">,</span>
<span class="linenos">60</span><span class="w">    </span><span class="nt">&quot;plot_in_logx&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to plot visibility distributions in log(baseline) in &#39;quick_plot&#39; and &#39;full_plot&#39;&quot;</span><span class="p">,</span>
<span class="linenos">61</span><span class="w">    </span><span class="nt">&quot;norm_residuals&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Whether to normalize plotted visibility residuals in &#39;full_plot&#39;&quot;</span>
<span class="linenos">62</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">63</span>
<span class="linenos">64</span><span class="w">  </span><span class="nt">&quot;analysis&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">65</span><span class="w">    </span><span class="nt">&quot;compare_profile&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Path of file with comparison profile to be overplotted with frank fit (.txt or .dat). Columns: r [arcsec], I [Jy / sr], optional 3rd column with a single error [Jy / sr] or optional 3rd and 4th columns with lower and upper errors&quot;</span><span class="p">,</span>
<span class="linenos">66</span><span class="w">    </span><span class="nt">&quot;clean_beam&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dictionary of B_major [arcsec], B_minor [arcsec], position angle [deg] of beam to convolve frank profile&quot;</span><span class="p">,</span>
<span class="linenos">67</span><span class="w">    </span><span class="nt">&quot;bootstrap_ntrials&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number of trials (dataset realizations) to perform in a bootstrap analysis&quot;</span>
<span class="linenos">68</span>
<span class="linenos">69</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">70</span><span class="p">}</span>
</pre></div>
</div>
<p>That’s it! frank saves (in <code class="code docutils literal notranslate"><span class="pre">save_dir</span></code>) these fit outputs: <br>
- the logged messages printed during the fit as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_fit.log</span></code>, <br>
- the parameter file used in the fit as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_used_pars.json</span></code>, <br>
- optionally, the fitted brightness profile as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_profile_fit.txt</span></code>, <br>
- optionally, the visibility domain fit as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_vis_fit.npz</span></code>, <br>
- optionally, the <code class="code docutils literal notranslate"><span class="pre">sol</span></code> (solution) object (see <a class="reference internal" href="py_API.html#frank.radial_fitters.FrankFitter"><span class="std std-ref">FrankFitter</span></a>) as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_sol.obj</span></code> and the <code class="code docutils literal notranslate"><span class="pre">iteration_diagnostics</span></code> object as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_iteration_diagnostics.obj</span></code>, <br>
- optionally, the UVTables for the <strong>reprojected</strong> fit and its residuals as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_uv_fit.npz</span></code> and <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_frank_uv_resid.npz</span></code>, <br>
- optionally, figures showing the fit and its diagnostics as <code class="code docutils literal notranslate"><span class="pre">&lt;uvtable_filename&gt;_*.png</span></code>.</p>
<p>Here’s the full figure frank produces (if <code class="code docutils literal notranslate"><span class="pre">full_plot=True</span></code> in your parameter file) for a fit to the DSHARP continuum observations of the protoplanetary disc
AS 209 (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2018ApJ...869L..41A/abstract">Andrews et al. 2018</a>).</p>
<figure class="align-left" style="width: 700px">
<img alt="_images/AS209_continuum_frank_fit_full.png" src="_images/AS209_continuum_frank_fit_full.png" />
</figure>
<p><strong>a)</strong> The fitted frank brightness profile. <br>
<strong>b)</strong> As in (a), on a log scale. The oscillations below <span class="math notranslate nohighlight">\(\approx 10^9\ {\rm Jy\ sr}^{-1}\)</span> indicate the fit’s noise floor. <br>
<strong>c)</strong> The frank profile swept over <span class="math notranslate nohighlight">\(2\pi\)</span> and reprojected. Note this image is not convolved with any beam. <br>
<strong>d)</strong> The visibility domain fit and the data in 1 and 50 <span class="math notranslate nohighlight">\({\rm k}\lambda\)</span> bins. <br>
<strong>e)</strong> As in (d), zooming on the low flux region to examine the fit at longer baselines.
frank walks off the visibilities as their binned noise begins to grow strongly beyond <span class="math notranslate nohighlight">\(\approx 4\ {\rm M}\lambda\)</span>. <br>
<strong>f)</strong> Residuals between the binned data and the fit. The residuals’ RMSE is given in the legend;
note this is being increased by the residuals beyond the baseline at which the fit walks off the data. <br>
<strong>g)</strong> The (binned) imaginary component of the visibilities. frank only fits the real component, so if Im(V) is large,
it could indicate azimuthal asymmetry in the disc that frank will average over.As in (d), on a log scale.
<strong>h)</strong> The fit’s reconstructed power spectrum, the prior on the fitted brightness profile. <br>
<strong>i)</strong> Histogram of the binned real component of the visibilities.
Note how the bin counts drop sharply beyond <span class="math notranslate nohighlight">\(\approx 4.5\ {\rm M}\lambda\)</span>,
a consequence of sparser sampling at the longest baselines. <br>
<strong>j)</strong> The data’s binned signal-to-noise (SNR). This begins to dither about SNR=1 beyond <span class="math notranslate nohighlight">\(\approx 4.5\ {\rm M}\lambda\)</span>.</p>
<section id="fit-for-the-source-geometry">
<h3>Fit for the source geometry<a class="headerlink" href="#fit-for-the-source-geometry" title="Permalink to this heading"></a></h3>
<p>frank fits for the source geometry to deproject the visibilities before fitting for the brightness profile.
See <a class="reference internal" href="tutorials/fitting_procedure.html#2.-Determinine-the-disc-geometry-and-deproject-the-visibilities"><span class="std std-ref">here</span></a> for approaches to the deprojection.</p>
</section>
<section id="test-the-fit-s-sensitivity-to-the-hyperparameters">
<h3>Test the fit’s sensitivity to the hyperparameters<a class="headerlink" href="#test-the-fit-s-sensitivity-to-the-hyperparameters" title="Permalink to this heading"></a></h3>
<p>It’s <strong>always</strong> important to check a fit’s sensitivity to the hyperparameters <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(w_{\rm smooth}\)</span>.
Often the sensitivity is quite weak, but for lower resolution or particularly noisy datasets,
the location and amplitude of substructure in the brightness profile can be sensitive to <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(w_{\rm smooth}\)</span>.
You can quickly check this sensitivity by running and overplotting multiple fits in a single call to frank.
Just set <code class="code docutils literal notranslate"><span class="pre">alpha</span></code> and/or <code class="code docutils literal notranslate"><span class="pre">wsmooth</span></code> in the parameter file as a list of values.
See <a class="reference internal" href="tutorials/prior_sensitivity.html"><span class="doc">this tutorial</span></a> for an example.</p>
</section>
<section id="understand-the-model-s-limitations">
<h3>Understand the model’s limitations<a class="headerlink" href="#understand-the-model-s-limitations" title="Permalink to this heading"></a></h3>
<p>See <a class="reference internal" href="tutorials/model_limitations.html"><span class="doc">this tutorial</span></a> for an explanation and discussion of the model’s limitations,
briefly summarized here: <br>
- Noise in the visibilities can imprint noise on the reconstructed brightness profile
(in the above fit to AS 209, this is limited to the regions of flux <span class="math notranslate nohighlight">\(\lesssim 10^9\)</span> Jy sr <span class="math notranslate nohighlight">\(^{-1}\)</span>). <br>
- The fit does not  by default prevent regions of negative brightness in the reconstructed profile
(as seen above in the AS 209 fit’s innermost gap). <br>
- The model yields a fitted brightness profile whose uncertainty is typically underestimated.
For this reason we do not show the uncertainty by default (note its absence in the above AS 209 fit).
See <a class="reference internal" href="tutorials/model_limitations.html#an-underestimated-brightness-profile-uncertainty"><span class="std std-ref">here</span></a> for a fuller discussion and mitigation approaches.</p>
</section>
<section id="examine-the-fit-s-convergence">
<h3>Examine the fit’s convergence<a class="headerlink" href="#examine-the-fit-s-convergence" title="Permalink to this heading"></a></h3>
<p>Once a fit has been performed, it can be useful to check its convergence.
A convergence test on the inferred power spectrum is performed as the fit iterates,
but you can additionally examine convergence of the inferred brightness profile by setting
<code class="code docutils literal notranslate"><span class="pre">diag_plot=True</span></code> in your parameter file.
frank will then produce a diagnostic figure to assess the fit’s convergence.
See <a class="reference internal" href="tutorials/fit_convergence.html"><span class="doc">this tutorial</span></a> for an example.</p>
</section>
<section id="modify-the-fit-py-script">
<h3>Modify the <code class="code docutils literal notranslate"><span class="pre">fit.py</span></code> script<a class="headerlink" href="#modify-the-fit-py-script" title="Permalink to this heading"></a></h3>
<p>We’ve run this example using <code class="code docutils literal notranslate"><span class="pre">frank/fit.py</span></code>; if you’d like to modify this file, you can get it <a class="reference external" href="https://raw.githubusercontent.com/discsim/frank/master/frank/fit.py">here</a>.
For an ‘under the hood’ look at what this script does, see <a class="reference internal" href="tutorials/fitting_procedure.html"><span class="doc">this tutorial</span></a>.
If you’d like a video demonstration of the same tutorial (with sound), see <a class="reference external" href="https://www.youtube.com/watch?v=xMxsLKQidY4&amp;t=5">here</a>.</p>
</section>
</section>
<section id="perform-a-fit-using-frank-as-a-python-module">
<h2>Perform a fit using <code class="code docutils literal notranslate"><span class="pre">frank</span></code> as a Python module<a class="headerlink" href="#perform-a-fit-using-frank-as-a-python-module" title="Permalink to this heading"></a></h2>
<p>To interface with the code more directly, you can use it as a module.
The wrapper functions in <code class="docutils literal notranslate"><span class="pre">fit.py</span></code> do everything we’ll show below,
but we’re going to mostly avoid those here,
just to show how to directly interface with the code’s internal classes.</p>
<p>First import some basic stuff from frank and load the data
(again using the DSHARP observations of AS 209, available as a UVTable - with time-averaging of 30 s and channel-averaging of 1 channel per spectral window -
<a class="reference external" href="https://github.com/discsim/frank/blob/master/docs/tutorials/AS209_continuum.npz">here</a>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">frank.io</span> <span class="kn">import</span> <span class="n">load_uvtable</span><span class="p">,</span> <span class="n">save_fit</span>
<span class="kn">from</span> <span class="nn">frank.radial_fitters</span> <span class="kn">import</span> <span class="n">FrankFitter</span>
<span class="kn">from</span> <span class="nn">frank.geometry</span> <span class="kn">import</span> <span class="n">FitGeometryGaussian</span>
<span class="kn">from</span> <span class="nn">frank.make_figs</span> <span class="kn">import</span> <span class="n">make_quick_fig</span>

<span class="n">save_prefix</span> <span class="o">=</span> <span class="s1">&#39;AS209_continuum&#39;</span>
<span class="n">uvtable_filename</span> <span class="o">=</span> <span class="n">save_prefix</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span>
<span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">vis</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">load_uvtable</span><span class="p">(</span><span class="n">uvtable_filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Now run the fit using the <a class="reference internal" href="py_API.html#frank.radial_fitters.FrankFitter"><span class="std std-ref">FrankFitter</span></a> class.
In this example we’ll fit for the disc’s geometry using the <a class="reference internal" href="py_API.html#frank.geometry.FitGeometryGaussian"><span class="std std-ref">FitGeometryGaussian</span></a> class.
<code class="code docutils literal notranslate"><span class="pre">FrankFitter</span></code> will then deproject the visibilities
and fit for the brightness profile. We’ll fit out to 1.6” using 250 collocation points and the code’s default <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">weights_smooth</span></code> hyperparameter values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FF</span> <span class="o">=</span> <span class="n">FrankFitter</span><span class="p">(</span><span class="n">Rmax</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">FitGeometryGaussian</span><span class="p">(),</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">weights_smooth</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">FF</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">vis</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>Now make a simplified figure showing the fit (a subset of plots from the full figure above,
plus the frank profile swept over <span class="math notranslate nohighlight">\(2\pi\)</span>, but face-on, in (e)).
When running from the terminal, frank produces this figure if <code class="code docutils literal notranslate"><span class="pre">quick_plot=True</span></code> in your parameter file).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">make_quick_fig</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">vis</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">bin_widths</span><span class="o">=</span><span class="p">[</span><span class="mf">1e3</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">],</span> <span class="n">force_style</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_prefix</span> <span class="o">+</span> <span class="s1">&#39;_frank_fit_quick.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>which makes this,</p>
<figure class="align-left" style="width: 700px">
<img alt="_images/AS209_continuum_frank_fit_quick.png" src="_images/AS209_continuum_frank_fit_quick.png" />
</figure>
<p>Finally we’ll save the fit results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">save_fit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">vis</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">save_prefix</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2024, R. Booth, J. Jennings, M. Tazzari..
      <span class="lastupdated">Last updated on 2024 Aug 22 at 16:32:13 UTC // Images: Universal Studios, NBCUniversal [Public domain].
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>